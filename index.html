<html>
	<head>
		<style>
			html, body{ margin:0; padding:0;} 
		</style>
		<script src='./three.js'></script>
		<!-- <script src='https://rawgit.com/mrdoob/three.js/master/build/three.js'></script> -->
		
		
		<script src='./orbit-controls.js'></script>
		
	</head>
	<body>

		<script>

				var /*scene = new THREE.Scene(),*/
					renderer = new THREE.WebGLRenderer({antialias:true}),
					camera = new THREE.PerspectiveCamera( 50, 1.2, 0.1, 10000000 )

					// renderer.gammaInput = true
					// renderer.gammaOutput = true

					renderer.setClearColor( 0xffffff )
					controls = new THREE.OrbitControls( camera )

					controls.autoRotate = true

				var animations = []

				document.body.appendChild( renderer.domElement )

				console.log( 'NEW')


				var texture = new THREE.TextureLoader().load('./htc_textures_pizza.png', function( texture ){


					texture.needsUpdate = true

				
					new THREE.ObjectLoader().load( './htc_shaderTest_008.json', function( scene ){

						console.log( scene )

					// new THREE.ColladaLoader().load( './dae-export.dae', function( geometry, materials ){


						// console.log( scene )
						var light = new THREE.AmbientLight( 0xffffff )
						scene.add( light )

						// scene.overrideMaterial = new THREE.MeshBasicMaterial({ map:texture, vertexColors:THREE.VertexColors})

						var clock = new THREE.Clock()
						// scene.children[0].rotation.y = -0.3
						// scene.children[0].rotation.x += 0.25
						camera.position.z = 20




						scene.traverse( function ( child ) {

							if ( child instanceof THREE.SkinnedMesh ){

								console.log( child.geometry.animations.length )
								child.material.skinning = true
								// var parent = child.parent
								// parent.remove( child )
								// var clonedMesh = new THREE.SkinnedMesh( child.geometry, child.material )
								// parent.add( clonedMesh )

								var animation = new THREE.Animation( child, child.geometry.animations[0] );
								animation.play();
								// animations.push( animation )

							}

						} );



						// scene.add( new THREE.DirectionalLight() )

						// var material = new THREE.MeshNormalMaterial({wireframe:false, side:THREE.DoubleSide, shading:THREE.FlatShading, wireframe:false/*, vertexColors: THREE.VertexColors*/, /*map:texture*/ })
						// // material.skinning = true;
						// // material.morphTargets = true;

						// // geometry.center()


						// var mesh = new THREE.Mesh( geometry, material )
						// mesh.frustumCulled = false

						// // mesh.scale.set( 0.1, 0.1, 0.1 )
						
						// // var mixer = new THREE.AnimationMixer( mesh );
						// var animations = []


						// helper = new THREE.SkeletonHelper( mesh );
						// helper.material.linewidth = 3;
						// helper.visible = true;
						// scene.add( helper );

						// mesh.scale.set( 1000, 1000, 1000 )
						// console.log( helper )



						// Create the animations		
						// for ( var i = 0; i < geometry.animations.length; ++ i ) {
						// 	var animName = geometry.animations[ i ].name;
						// 	animations[ animName ] = geometry.animations[ i ];
						// }



						// scene.add( mesh )
						// mesh.rotation.y = Math.PI * -0.5
						// mesh.rotation.y = Math.PI * 0.5
						
						// mixer.play( new THREE.AnimationAction( geometry.animations[ 0 ] ))
						// var animation = new THREE.Animation( mesh, geometry.animations[0] );
					// animation.play();

						// mesh.scale.set( 10, 10, 10 )


						function render(){

							THREE.AnimationHandler.update( clock.getDelta()  );
							// mixer.update( clock.getDelta() );
							// helper.update();

							// controls.update()
							// RENDER STEP - fbo's, post etc
							renderer.render( scene, camera )
							requestAnimationFrame( render )

						}

						


						function setSize( w, h ){

							camera.aspect = w / h;
							camera.updateProjectionMatrix();

							console.log( 'sdf')
							renderer.setSize( w, h )

						}

						setSize( window.innerWidth, window.innerHeight )
						window.addEventListener( 'resize', function(){ setSize( window.innerWidth, window.innerHeight )})
						console.log('RENDER')
						render()

					})
				})

		</script>
	</body>
</html>